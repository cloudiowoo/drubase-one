{#
/**
 * @file
 * BaaSç»Ÿä¸€æ–‡ä»¶ç®¡ç†ç•Œé¢æ¨¡æ¿ã€‚
 *
 * Available variables:
 * - tenants: ç”¨æˆ·å¯è®¿é—®çš„ç§Ÿæˆ·åˆ—è¡¨
 * - projects: ç”¨æˆ·å¯è®¿é—®çš„é¡¹ç›®åˆ—è¡¨
 * - statistics: æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯
 * - user_permissions: ç”¨æˆ·æƒé™
 */
#}

<div class="baas-file-manager">
  <div class="file-manager-header">
    <h1 class="page-title">{{ 'BaaSæ–‡ä»¶ç®¡ç†'|t }}</h1>
    <div class="header-actions">
      {% if user_permissions.manage_project_files %}
        <button class="btn btn-primary upload-file-btn" data-action="upload">
          <i class="icon-upload"></i> {{ 'ä¸Šä¼ æ–‡ä»¶'|t }}
        </button>
      {% endif %}
      {% if user_permissions.view_file_statistics %}
        <button class="btn btn-secondary statistics-btn" data-action="statistics">
          <i class="icon-chart"></i> {{ 'ç»Ÿè®¡ä¿¡æ¯'|t }}
        </button>
      {% endif %}
    </div>
  </div>

  <div class="file-manager-content">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <div class="statistics-overview">
      <div class="stat-card">
        <div class="stat-value">{{ statistics.total_files }}</div>
        <div class="stat-label">{{ 'æ€»æ–‡ä»¶æ•°'|t }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ statistics.total_size_formatted }}</div>
        <div class="stat-label">{{ 'æ€»å­˜å‚¨ç©ºé—´'|t }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ projects|length }}</div>
        <div class="stat-label">{{ 'é¡¹ç›®æ•°é‡'|t }}</div>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="file-manager-main">
      <!-- å·¦ä¾§å¯¼èˆª - ä»…æ˜¾ç¤ºé¡¹ç›® -->
      <div class="file-manager-sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">{{ 'æˆ‘çš„é¡¹ç›®'|t }}</h3>
          <ul class="project-list">
            {% for project in projects %}
              <li class="project-item" data-project-id="{{ project.id }}" data-tenant-id="{{ project.tenant_id }}">
                <div class="project-info">
                  <span class="project-name">{{ project.name }}</span>
                  <span class="project-role badge badge-{{ project.role }}">{{ project.role|title }}</span>
                </div>
                {% if statistics.by_project[project.id] %}
                  <div class="project-stats">
                    <small>{{ statistics.by_project[project.id].file_count }} æ–‡ä»¶ | {{ statistics.by_project[project.id].total_size_formatted }}</small>
                  </div>
                {% endif %}
                <div class="project-permissions">
                  {% if project.file_permissions.view %}
                    <span class="permission view" title="{{ 'æŸ¥çœ‹æƒé™'|t }}">ğŸ‘</span>
                  {% endif %}
                  {% if project.file_permissions.upload %}
                    <span class="permission upload" title="{{ 'ä¸Šä¼ æƒé™'|t }}">â¬†</span>
                  {% endif %}
                  {% if project.file_permissions.manage %}
                    <span class="permission manage" title="{{ 'ç®¡ç†æƒé™'|t }}">âš™</span>
                  {% endif %}
                  {% if project.file_permissions.delete %}
                    <span class="permission delete" title="{{ 'åˆ é™¤æƒé™'|t }}">ğŸ—‘</span>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- å³ä¾§æ–‡ä»¶å†…å®¹åŒºåŸŸ -->
      <div class="file-manager-content-area">
        <div class="content-header">
          <div class="breadcrumb">
            <span class="breadcrumb-item active">{{ 'æ‰€æœ‰æ–‡ä»¶'|t }}</span>
          </div>
          <div class="view-controls">
            <button class="btn btn-sm view-grid active" data-view="grid">
              <i class="icon-grid"></i>
            </button>
            <button class="btn btn-sm view-list" data-view="list">
              <i class="icon-list"></i>
            </button>
          </div>
        </div>

        <div class="file-content" id="file-content">
          <div class="loading-state">
            <div class="spinner"></div>
            <p>{{ 'æ­£åœ¨åŠ è½½æ–‡ä»¶...'|t }}</p>
          </div>
        </div>

        <!-- åˆ†é¡µå™¨ -->
        <div class="file-pagination" id="file-pagination"></div>
      </div>
    </div>
  </div>
</div>

<!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
<div class="modal fade" id="uploadModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ 'ä¸Šä¼ æ–‡ä»¶'|t }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="upload-form" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="upload-project" class="form-label">{{ 'é€‰æ‹©é¡¹ç›®'|t }}</label>
            <select class="form-select" id="upload-project" required>
              <option value="">{{ 'è¯·é€‰æ‹©é¡¹ç›®'|t }}</option>
              {% for project in projects %}
                {% if project.file_permissions.upload %}
                  <option value="{{ project.id }}">{{ project.name }}</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="upload-files" class="form-label">{{ 'é€‰æ‹©æ–‡ä»¶'|t }}</label>
            <input type="file" class="form-control" id="upload-files" multiple>
            <div class="form-text">{{ 'æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œæœ€å¤§å•æ–‡ä»¶å¤§å°: 50MB'|t }}</div>
          </div>
          <div class="upload-progress" style="display: none;">
            <div class="progress">
              <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ 'å–æ¶ˆ'|t }}</button>
        <button type="button" class="btn btn-primary" id="upload-submit">{{ 'ä¸Šä¼ '|t }}</button>
      </div>
    </div>
  </div>
</div>

<!-- æ–‡ä»¶è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal fade" id="fileDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ 'æ–‡ä»¶è¯¦æƒ…'|t }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="file-detail-content">
        <!-- åŠ¨æ€åŠ è½½æ–‡ä»¶è¯¦æƒ… -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ 'å…³é—­'|t }}</button>
        <div class="file-actions">
          <button type="button" class="btn btn-primary download-btn">{{ 'ä¸‹è½½'|t }}</button>
          <button type="button" class="btn btn-danger delete-btn">{{ 'åˆ é™¤'|t }}</button>
        </div>
      </div>
    </div>
  </div>
</div>