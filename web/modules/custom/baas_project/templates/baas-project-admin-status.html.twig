{#
/**
 * @file
 * Template for BaaS Project system status page.
 *
 * Available variables:
 * - status: System status information
 * - navigation: Navigation links
 */
#}

<div class="baas-project-admin">
  <h1>{{ 'BaaS Project System Status'|t }}</h1>
  
  {% if navigation %}
    <div class="baas-project-navigation">
      {% for key, link in navigation %}
        {{ link }}
      {% endfor %}
    </div>
  {% endif %}
  
  {% if status %}
    <!-- Migration Status -->
    {% if status.migration_status %}
      <div class="baas-project-migration-status {{ status.migration_status.is_migrated ? 'migrated' : 'not-migrated' }}">
        <h3>
          <span class="status-icon {{ status.migration_status.is_migrated ? 'success' : 'warning' }}"></span>
          {{ 'Migration Status'|t }}
        </h3>
        
        <p>
          <strong>{{ 'Status:'|t }}</strong> 
          {{ status.migration_status.is_migrated ? 'Completed'|t : 'Pending'|t }}
        </p>
        
        {% if status.migration_status.timestamp %}
          <p>
            <strong>{{ 'Migration Date:'|t }}</strong> 
            {{ status.migration_status.timestamp|date('Y-m-d H:i:s') }}
          </p>
        {% endif %}
        
        {% if status.migration_status.validation %}
          <p>
            <strong>{{ 'Validation:'|t }}</strong> 
            {{ status.migration_status.validation.valid ? 'Passed'|t : 'Failed'|t }}
          </p>
          
          {% if not status.migration_status.validation.valid and status.migration_status.validation.errors %}
            <div class="messages messages--error">
              <strong>{{ 'Validation Errors:'|t }}</strong>
              <ul>
                {% for error in status.migration_status.validation.errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        {% endif %}
      </div>
    {% endif %}
    
    <!-- System Statistics -->
    {% if status.statistics %}
      <div class="baas-project-status-cards">
        <div class="baas-project-status-card">
          <h3>{{ 'Projects'|t }}</h3>
          <div class="value">{{ status.statistics.projects|number_format }}</div>
          <div class="description">{{ 'Total active projects'|t }}</div>
        </div>
        
        <div class="baas-project-status-card">
          <h3>{{ 'Tenants'|t }}</h3>
          <div class="value">{{ status.statistics.tenants|number_format }}</div>
          <div class="description">{{ 'Total active tenants'|t }}</div>
        </div>
        
        <div class="baas-project-status-card">
          <h3>{{ 'Members'|t }}</h3>
          <div class="value">{{ status.statistics.members|number_format }}</div>
          <div class="description">{{ 'Total project members'|t }}</div>
        </div>
        
        <div class="baas-project-status-card">
          <h3>{{ 'Entity Templates'|t }}</h3>
          <div class="value">{{ status.statistics.templates|number_format }}</div>
          <div class="description">{{ 'Total entity templates'|t }}</div>
        </div>
        
        {% if status.statistics.migrated_templates is defined %}
          <div class="baas-project-status-card">
            <h3>{{ 'Migrated Templates'|t }}</h3>
            <div class="value">{{ status.statistics.migrated_templates|number_format }}</div>
            <div class="description">{{ 'Templates with project association'|t }}</div>
          </div>
        {% endif %}
      </div>
    {% endif %}
    
    <!-- Health Checks -->
    {% if status.health_checks %}
      <div class="baas-project-health-checks">
        <h3>{{ 'System Health Checks'|t }}</h3>
        
        {% for check_key, check in status.health_checks %}
          <div class="baas-project-health-check">
            <span class="check-icon {{ check.status }}"></span>
            <span class="check-name">{{ check.name }}</span>
            <span class="check-message">{{ check.message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- System Information -->
    <div class="baas-project-system-info">
      <h3>{{ 'System Information'|t }}</h3>
      
      <div class="baas-project-info-grid">
        <div class="info-item">
          <strong>{{ 'Module Version:'|t }}</strong>
          <span>{{ '1.0.0'|t }}</span>
        </div>
        
        <div class="info-item">
          <strong>{{ 'Drupal Version:'|t }}</strong>
          <span>{{ drupal_version() }}</span>
        </div>
        
        <div class="info-item">
          <strong>{{ 'PHP Version:'|t }}</strong>
          <span>{{ php_version() }}</span>
        </div>
        
        <div class="info-item">
          <strong>{{ 'Database Type:'|t }}</strong>
          <span>{{ database_type() }}</span>
        </div>
      </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="baas-project-quick-actions">
      <h3>{{ 'Quick Actions'|t }}</h3>
      
      <div class="action-buttons">
        <a href="{{ path('baas_project.admin.migrate') }}" class="baas-project-button primary">
          {{ 'Migration Management'|t }}
        </a>
        
        <button class="baas-project-button secondary js-refresh-status">
          {{ 'Refresh Status'|t }}
        </button>
        
        <a href="{{ path('system.modules_list') }}" class="baas-project-button secondary">
          {{ 'Module Management'|t }}
        </a>
        
        <a href="{{ path('system.status') }}" class="baas-project-button secondary">
          {{ 'System Status'|t }}
        </a>
      </div>
    </div>
    
  {% else %}
    <div class="messages messages--error">
      {{ 'Unable to retrieve system status information.'|t }}
    </div>
  {% endif %}
</div>

<style>
.baas-project-navigation {
  margin-bottom: 30px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 6px;
}

.baas-project-navigation a {
  margin-right: 15px;
  text-decoration: none;
  color: #0073aa;
  font-weight: bold;
}

.baas-project-navigation a:hover {
  text-decoration: underline;
}

.baas-project-info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.info-item {
  padding: 10px;
  background: #f8f9fa;
  border-radius: 4px;
  border-left: 4px solid #0073aa;
}

.info-item strong {
  display: block;
  margin-bottom: 5px;
  color: #333;
}

.info-item span {
  color: #666;
  font-family: monospace;
}

.baas-project-quick-actions {
  margin-top: 30px;
  padding: 20px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
}

.action-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
}

.action-buttons .baas-project-button {
  flex: 0 0 auto;
}

@media (max-width: 768px) {
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons .baas-project-button {
    width: 100%;
  }
}
</style>